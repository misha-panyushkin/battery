/* Battery - v0.0.1 - 2015-03-01
 * Homepage: http://battery.panyushk.in/
 * Author: Misha Panyushkin <misha.panyushkin@gmail.com>
 * Copyright.*/

!function(a){function b(a){a=a||{};for(d in this.defaults)this.defaults.hasOwnProperty(d)&&(this[d]=this.defaults[d](a[d]));this.connections=[],e.call(this)}function c(a){return this.wasted?void 0:(a=a||0,this.quantity+=a,this.quantity=this.quantity>this.capacity?this.capacity:this.quantity,this.quantity)}function e(){e.timeout=setTimeout(function(){var a={chargers:[],unchargers:[]};if(this.connections.reduce(function(a,b){return b.charger&&a.chargers.push(b.charger),b.uncharger&&a.unchargers.push(b.uncharger),a},a),a.chargers.forEach(function(a){a.call(null,c.bind(this))}.bind(this)),a.unchargers.forEach(function(a){a.call(null,f.bind(this))}.bind(this)),this.lifetime){if(this.lifetime-=this.timeunit,0===this.lifetime)return void(this.wasted=1);this.lifetime<0&&(this.timeunit=this.lifetime*=-1)}e.call(this)}.bind(this),this.timeunit)}function f(a){return this.wasted?void 0:(a=a||0,this.quantity<a?(a=this.quantity,this.quantity=0):this.quantity-=a,a)}b.prototype.defaults={wasted:function(a){return parseInt(a)?Math.abs(a)&&1:0},quantity:function(a){return a>0?a:0},capacity:function(a){return a>0?a:100},lifetime:function(a){return a>0?a:null},timeunit:function(a){return a>0?a:1e3}},b.prototype.setConnection=function(a,b){return this.connections.push({id:this.connections.length,charger:a,uncharger:b})-1},b.prototype.removeConnection=function(a){this.connections.splice(a,1)},a.Battery=function(a){return new b(a)},Function.prototype.bind=Function.prototype.bind||function(a){var b=Array.prototype.slice.call(arguments,1),c=this;return function(){var d=Array.prototype.slice.call(arguments);return c.apply(a,b.concat(d))}}}(this,this);